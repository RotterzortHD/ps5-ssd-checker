---
// src/components/CompatibilityCheck.astro
import { checkCompatibility } from '../utils/checkCompatibility';

const { ssd, consoleType = 'ps5' } = Astro.props;

// Wir rufen jetzt die neue, flexible Funktion auf
const result = checkCompatibility(ssd, consoleType);

// Deine Farben-Logik (unverändert, aber nutzt jetzt das neue 'result')
const speedPercentage = Math.min((ssd.read_speed_mb_s / 7500) * 100, 100);
const accentColor = result.status === 'green' ? 'text-emerald-400' : result.status === 'red' ? 'text-rose-500' : 'text-amber-400';
const glowColor = result.status === 'green' ? 'shadow-emerald-500/20' : result.status === 'red' ? 'shadow-rose-500/20' : 'shadow-amber-500/20';
const barColor = result.status === 'green' ? 'bg-emerald-500' : result.status === 'red' ? 'bg-rose-500' : 'bg-amber-500';
const bgBorder = result.status === 'green' ? 'bg-emerald-900/10 border-emerald-500/30' : result.status === 'red' ? 'bg-rose-900/10 border-rose-500/30' : 'bg-amber-900/10 border-amber-500/30';
const iconBg = result.status === 'green' ? 'bg-emerald-500/20 text-emerald-400' : result.status === 'red' ? 'bg-rose-500/20 text-rose-400' : 'bg-amber-500/20 text-amber-400';
---

<section class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start animate-fade-in">
  
  <div class="lg:col-span-7">
    <div class="relative w-full aspect-video bg-gradient-to-br from-slate-900 to-black rounded-2xl border border-white/10 flex items-center justify-center overflow-hidden group">
        <div class="absolute inset-0 opacity-20" style="background-image: radial-gradient(#ffffff 1px, transparent 1px); background-size: 20px 20px;"></div>
        
        <div class="relative w-64 h-20 bg-slate-800 rounded border border-slate-600 shadow-2xl transform transition duration-500 group-hover:scale-105 flex items-center px-4 justify-between z-10">
            <div class="absolute left-0 top-0 h-full w-2 bg-yellow-500 rounded-l"></div>
            <div class="flex gap-1">
              <div class="w-8 h-8 bg-black rounded border border-slate-700"></div>
              <div class="w-8 h-8 bg-black rounded border border-slate-700"></div>
            </div>
            <div class="text-right">
              <div class="text-[10px] text-slate-400 font-mono">{ssd.form_factor ? `Type ${ssd.form_factor}` : 'M.2 NVMe'}</div>
              <div class="text-sm font-bold text-white">{ssd.brand}</div>
            </div>
        </div>
    </div>
  </div>

  <div class="lg:col-span-5">
    <div class={`rounded-3xl p-8 border backdrop-blur-xl shadow-2xl ${bgBorder} ${glowColor}`}>
        <div class="flex items-start justify-between mb-6">
            <div>
              <h2 class={`text-2xl font-bold mb-1 ${accentColor}`}>{result.title}</h2>
              <p class="text-sm text-slate-400">Kompatibilitäts-Check ({consoleType === 'ps5' ? 'PlayStation 5' : 'Steam Deck'})</p>
            </div>
            <div class={`w-12 h-12 rounded-full flex items-center justify-center text-2xl ${iconBg}`}>
              {result.status === 'green' ? '✓' : result.status === 'red' ? '✕' : '!'}
            </div>
        </div>
        
        <p class="text-slate-300 leading-relaxed mb-6 border-t border-white/10 pt-4">
          {result.message}
        </p>

        <div class="bg-black/40 rounded-xl p-4 border border-white/5">
            <div class="flex justify-between text-xs text-slate-500 mb-2 font-mono">
              <span>SPEED</span>
              <span>{ssd.read_speed_mb_s} MB/s</span>
            </div>
            <div class="w-full h-2 bg-slate-800 rounded-full overflow-hidden">
              <div class={`h-full rounded-full shadow-[0_0_10px_rgba(0,0,0,0.5)] transition-all duration-1000 ease-out ${barColor}`} style={`width: ${speedPercentage}%`}></div>
            </div>
        </div>
    </div>
  </div>

</section>